<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="css/jquery-ui.css" />
<link rel="stylesheet" href="css/main.css" />
<script src="js/jquery-1.12.4.js"></script>
<script src="js/jquery-ui.js"></script>

<script>
	var seat = [];//좌석 넘버링용 배열
	$(function() {
		/* 좌석 배치 이벤트 */

		$(document).click(function() {
			//alert('Handler for .mousedown() called.');
			$(".pre_seat, .af_seat").draggable({
				containment : "#map",
				snap : true,
				//다른좌석과 객체가 겹칠때 revert를 시킨다
				revert : "valid"
			//grid:[5,5]
			});
			$(".pre_seat, .af_seat").droppable({
				classes : {
					"ui-droppable-active" : "ui-state-active",
					"ui-droppable-hover" : "ui-state-hover"
				}
			});

		});

		//총 좌석수 숫자 변경
		$("#totalCntChangeB").click(function() {
			var totalCntChangeT = $("#totalCntChangeT").val();//입력 받은 좌석 수
			if (totalCntChangeT != "") {
				console.log(totalCntChangeT);
				if (confirm("기존 좌석 배치가 리셋 됩니다.계속 진행 하시겠습니까?") == true) {

					$(".af_seat").remove();//추후 쿼리로 모든 좌석 초기화 시키기

				} else {//confirm  //취소시
					return;
				}
			}//totalCntChangeT
		})

		//추가 좌석 수 확인을 누르면
		var n = 1;
		$("#confirm").click(
				function() {
					var newSeatCnt_garo = $("#input_seat_garo").val();//입력 받은 가로 좌석 수
					var newSeatCnt_sero = $("#input_seat_sero").val();//입력 받은 세로 좌석 수
					var newSeatCnt = newSeatCnt_sero * newSeatCnt_garo;
					
					var pre_seat_case = document
							.getElementById("pre_seat_case");
					var pre_seat = $(".pre_seat");
					
					//추가한 부분
					var garo = Math.floor(880 / newSeatCnt_garo);
					var sero = Math.floor(garo / 3 * 2);

					for (var i = parseInt(newSeatCnt); i > 0; i--) {//갯수 만큼 div 생성
						seat[i + pre_seat.length] = document
								.createElement("div");//객체 생성
						seat[i + pre_seat.length].setAttribute("id", "s"
								+ (i + pre_seat.length) + "");//id 지정 
						seat[i + pre_seat.length].setAttribute("class",
								"pre_seat");//class 이름 지정
						seat[i + pre_seat.length].setAttribute("num",
								(i + pre_seat.length));
						//console.log("i:"+i +"/"+"newSeatCnt:"+newSeatCnt);
						seat[i + pre_seat.length].innerHTML = i
								+ pre_seat.length + "";//번호 넘버링
						pre_seat_case.appendChild(seat[i + pre_seat.length]);

					}//for

					if (garo >= 90) {//최대 크기
						$(".pre_seat").css("width", "90px");
						$(".pre_seat").css("height", "60px");

					} else if (garo < 30) {//최소 크기
						$(".pre_seat").css("width", "30px");
						$(".pre_seat").css("height", "20px");

					} else {
						$(".pre_seat").css("width", garo + "px");
						$(".pre_seat").css("height", sero + "px");
					}
					
					/* 좌석 취소 이벤트(오른쪽클릭) -->시점 때문에 여기서 생성*/
					//if(n==1){
					$(".pre_seat").unbind("dblclick");
					$(".pre_seat").dblclick(function() {
						//if($(this).parents("#map")[0]==$("#map")[0]){

						var num = $(this).attr("num");
						console.log(num);
						seat.splice(num, 1);
	
						for (var n = parseInt(num); n < seat.length; n++) {
							console.log("num" + num);
							//console.log("num:" + n);
							seat[n].setAttribute("id", "s" + n);
							seat[n].setAttribute("num", n);
							seat[n].innerHTML = n; //번호 넘버링
							console.log("seat.length:" + seat.length);
						}
						$(this).remove();

						for (var n = 0; n < seat.length; n++) {
							//console.log(seat[n]);
						}
					});
					// n++;

					/* for(var n in seat){
					   console.log("seat:"+seat[n].getAttribute("num"));
					} */

				})

		$(".af_seat").dblclick(function() {
			//if($(this).parents("#map")[0]==$("#map")[0]){
			$(this).remove();
			//}            
		});

		
		
		
		
		
		

		/*봇형 자료 2017-01-31*/
		//초기화 버튼 누를 시 다 삭제
	      $("#reset_btn").click(function(){
	         var pre_seat = $(".pre_seat");
	         
	         for(i=0;i<pre_seat.length;i++){
	            pre_seat[i].remove();
	         }
	         
	         //좌석 출력 정보 초기화
	         infoSeat();
	      });   //초기화 끝
	      
	      //저장 버튼 누를 시 색상 변환(임시로 색깔 넣음)
	      $("#save_btn").click(function(){
	         var pre_seat = $(".pre_seat");
	         
	         for(i=0;i<pre_seat.length;i++){
	           var num = "#s"+(1+i);
	           //조건으로 걸려내야하는데 아직 못함.
	           $(num).css("background-color","red");
	           //임시로 저장된건 사용중으로 부여
	           $(num).attr("use","사용중");
	         }
	         
	         //좌석 출력 정보 초기화
	         infoSeat();
	         
	      });   //저장 끝
		
	      /* 
	      //좌석 상황 인터벌 시작 - 5초단위
	      setInterval(function(){
	         infoSeat();
	      }, 5000);	 
	      */
		
		
	});//onload
	
	
	
	
	
	
	
	
	
	
	
	
	

	/*봇형 자료 2017-01-31*/
	//현재 좌석 사용 상황 함수
	   function infoSeat(){
	      var seat = $(".pre_seat");
	      $("#totalCntChangeT")[0].setAttribute("value", seat.length);
	      var use_seat = 0;
	      for(var i=0;i<seat.length;i++){
	         
	         var num = "#s"+(1+i);
	         if($(num).attr("use") == "사용중"){
	            use_seat++;
	         }
	         
	      }
	      $("#nowUsingSeatCnt")[0].setAttribute("value", use_seat);
	      $("#seat_yet_info")[0].setAttribute("value", parseInt(seat.length)-use_seat);
	      
	      
	   }
</script>
</head>
<body>
	<div id="container">
		<div id="side">

		<!-- 수정 -->
			<div id="seatCnt_input">
				추가 좌석수 입력 <br> <input type="text" id="input_seat_garo" size="8"
					value="" placeholder="가로" /> <input type="text"
					id="input_seat_sero" size="8" value="" placeholder="세로" /><input
					type="button" id="confirm" value="확인">
			</div>
			<div id="seat_yet_left">
				배치 안된 divs
				<div id="pre_seat_case">
					<!-- 열람실좌석 객체 위치 -->
					<!-- <div id="s1" class="seat_one">
               </div> -->



				</div>
			</div>
			<div id="product">
				<div id="resetCase">
					<input type="button" id="reset_btn" value="초기화" style="width: 45%;" />
					<input type="button" id="save_btn" value="저장" style="width: 45%;" />
				</div>
			</div>
		</div>

		<div id="main">
			<div id="info">
				<div id="company">
					<div id="companyName">
						<select id="university">
							<option value="용인대학교">용인대학교</option>
							<!-- <option value="사과">사과</option>
                     <option value="파인애플" selected="selected">파인애플</option> -->
						</select>
					</div>
					<div id="location">
						<select id="univer_location">
							<option value="신관 4층">신관 4층</option>
							<!-- <option value="사과">사과</option>
                     <option value="파인애플" selected="selected">파인애플</option> -->
						</select>
					</div>
				</div>
				<div id="nowSeat">
					<!-- 총 좌석 수를 기본 value로 둔다 DB에서 불러와서 value에 넣기 -->
					<div class="nowSeat">
						총 좌석 수<br> <input type="text" size="3" id="totalCntChangeT"
							disabled="disabled" />
					</div>
					<!-- 처음 로딩시 DB에서 배정 된 갯수 불러온다. value = 넣기    -->
					<div class="nowSeat">
						사용중<br> <input type="text" size="3" value=""
							id="nowUsingSeatCnt" disabled="disabled" />

					</div>
					<div class="nowSeat">
						빈 좌석<br> <input type="text" size="3" value=""
							id="seat_yet_info" disabled="disabled" />
					</div>
				</div>
				<div id="showStateImg">색깔별 정보 이미지 표시</div>
				<div id="nowTime">2017-01-09 오후 4:33</div>

			</div>
			<div id="map">
				<div id="s50" class="af_seat">50</div>

			</div>
		</div>
		<div style="clear: both;"></div>
	</div>

</body>
</html>